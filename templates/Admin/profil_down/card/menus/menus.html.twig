<div class="drop-shadow-lg bg-500 text-secondary">
    <section class="py-6 after relative">
        <p class="w-11/12 mx-auto max-w-[598px] pb-3 underline underline-offset-2">Ajouter un menu :</p>
        {{ form_start(form_menu, { 'attr' : { 'class' : 'bg-600 w-11/12 mx-auto max-w-[598px] flex flex-col justify-center p-4 text-secondary' }}) }}
        <div class="after relative after:bg-secondary after:opacity-50">
            <div class="flex gap-2">
                <div class="flex-1">
                    <div class="hidden">{{ form_label(form_menu.title) }}</div>
                    {{ form_widget(form_menu.title, { 'attr' : { 'class' : 'w-full pr-2 bg-primary/20 input_whitePlaceholder input_withoutIcon' }}) }}
                    <small class="form_error">
                        {{ form_errors(form_menu.title) }}
                    </small>
                </div>
                <button type="submit" class="bg-primary/50 button_profil">
                    <i class="fa-solid fa-plus text-secondary"></i>
                </button>
            </div>
            <button type="button" class="add_item_link text-secondary bg-primary/50 px-4 py-2 relative left-1/2 -translate-x-1/2 my-3" data-collection-holder-class="offers">Ajouter une formule</button>
        </div>
        <ul class="offers"
            data-index="{{ form_menu.offers|length > 0 ? form_menu.offers|last.vars.name + 1 : 0 }}"
            data-prototype="{{ _self.offers_prototype_empty(form_menu.offers.vars.prototype)|e('html_attr') }}"
            >
            {% for offer in form_menu.offers %}
                {{ _self.offers_prototype_empty(offer) }}
            {% endfor %}
        </ul>
    {{ form_rest(form_menu) }}
    {{ form_end(form_menu) }}
    </section>
    <section class="flex flex-col gap-7 py-6">
        <ul>
        {% for key, menu in menus %}
            <li class="after my-2 relative after:bg-secondary/50 after:w-2/5 flex flex-col gap-2">
                <form onSubmit="setMenu(event)" method="post" class="bg-600 w-11/12 mx-auto max-w-[598px] flex flex-col justify-center p-4 text-secondary" id="{{ 'menu_'~ menu.id }}">
                    <div class="relative after:bg-secondary after:opacity-50">
                        <div class="flex gap-8">
                            <div class="flex gap-2 flex-1">
                                <div class="flex-1">
                                    <label for="{{ 'title_'~ menu.id }}" hidden>{{ menu.title }}</label>
                                    <input minLength=2 maxLength=150  required type="text" id="{{ 'title_'~ menu.id }}" name="{{ 'title_'~ menu.id }}" value="{{ menu.title }}" class="w-full pr-2 bg-primary/20 input_whitePlaceholder input_withoutIcon" value="{{ menu.title }}">
                                </div>
                                <div class="flex gap-2">
                                    <button type="submit" class="bg-primary/50 button_profil" aria-label="Modifier">
                                        <i class="fa-solid fa-pen text-secondary button-full"></i>
                                    </button>
                                    <button aria-label="Supprimer" id="{{ 'delete_'~ menu.id }}" onclick="handleDeleteOffer(event)" class="">
                                        <i class="fa-solid fa-trash bg-primary/50 button_profil button-full"></i>
                                    </button>
                                </div>
                            </div>
                            <button class="text-2xl" onclick="showMenu(event)">
                                <i class="fa-solid fa-caret-down text-secondary button-full"></i>
                                <i class="hide fa-solid fa-caret-up button-full"></i>
                            </button>
                        </div>
                        <button type="button" class="hide text-secondary bg-primary/50 px-4 py-2 relative left-1/2 -translate-x-1/2 my-3" onclick="addOffer(event)">Ajouter une formule</button>
                    </div>
                    <ul class="modify_offers hide" 
                    >
                    {% for key, offer in menu.offers %}
                        {{ _self.offers_prototype(key, offer, key) }}
                    {% endfor %}
                    </ul>
                </form>
            </li>
        {% endfor %}
        </ul>
    </section>
</div>


{% macro offers_prototype_empty(offer) %}
<li class="offer_model after my-2 relative after:bg-secondary/50 after:w-2/5 flex flex-col gap-2">
    <div class="flex gap-2">
        <div class="name flex flex-1 gap-1">
            <div class="hidden">{{ form_label(offer.title) }}</div>
            {{ form_widget(offer.title, { 'attr' : { 'class' : 'offer_title_model flex-1 w-full pr-2 bg-primary/20 input_whitePlaceholder input_withoutIcon' }}) }}
            <small class="form_error">
                {{ form_errors(offer.title) }}
            </small>
        </div>
    </div>
    <div>
        <div class="hidden">{{ form_label(offer.conditions) }}</div>
        {{ form_widget(offer.conditions, { 'attr' : { 'class' : 'offer_conditions_model w-full pr-2 bg-primary/20 input_whitePlaceholder input_withoutIcon' }}) }}
        <small class="form_error">
            {{ form_errors(offer.conditions) }}
        </small>
    </div>
    <div class="flex justify-between items-center">
        <p class="underline underline-offset-2">Composition :</p>
        <button type="button" class="add_item_link text-secondary bg-primary/50 px-4 py-1" data-collection-holder-class="compositions">Ajouter</button>
    </div>
    <ol class="compositions_model compositions flex flex-col gap-2"
    data-index="{{ offer.description|length > 0 ? offer.description|last.vars.name + 1 : 0 }}"
    data-prototype="{{  _self.compositions_prototype_empty(offer.description.vars.prototype)|e('html_attr') }}"
    >
    {% for composition in offer.description %}
        {{ _self.compositions_prototype_empty(composition) }}
    {% endfor %}
    </ol>
    <div class="my-2 relative after:conten-[''] before:absolute before:w-[100px] before:h-px before:bg-secondary before:opacity-50 before:-top-2">
        <div class="hidden">{{ form_label(offer.price) }}</div>
        <div class="flex items-center input_profil w-[120px]">
            <i class="fa-solid fa-euro-sign form_icon bg-primary/20"></i>
            {{ form_widget(offer.price, { 'attr' : { 'class' : 'pr-2 bg-primary/20 input_whitePlaceholder input_withoutIcon' }}) }}
        </div>
        <small class="form_error">
            {{ form_errors(offer.price) }}
        </small>
    </div>
</li>
{% endmacro %}
{% macro compositions_prototype_empty(composition) %}
    <li class="name flex gap-2" >
        <div class="flex-1">
            <div class="hidden">{{ form_label(composition) }}</div>
            {{ form_widget(composition, { 'attr' : { 'class' : 'offer_model pr-2 bg-primary/20 input_whitePlaceholder input_withoutIcon', 'placeholder' : 'Plat...' }}) }}
            <small class="form_error">
                {{ form_errors(composition) }}
            </small>
        </div>
    </li>
{% endmacro %}
{% macro offers_prototype(key, offer, key_menu) %}
<li class="after my-2 relative after:bg-secondary/50 after:w-2/5 flex flex-col gap-2" >
    <div class="flex gap-2">
        <div class="flex-1">
            <label hidden for="{{'offer_title_'~ key }}">Titre :</label>
            <input required minLength=2 maxLength=150  type="text" class="w-full pr-2 bg-primary/20 input_whitePlaceholder input_withoutIcon" id="{{ 'offer_title_'~ key}}" name="{{ 'offer_title_'~ key}}" value="{{ offer.title }}">
        </div>
    </div>
    <div>
        <label hidden for="{{'offer_conditions_'~ key }}">Conditions :</label>
        <input maxLength=150  type="text" class="w-full pr-2 bg-primary/20 input_whitePlaceholder input_withoutIcon" id="{{ 'offer_conditions_'~ key}}" name="{{ 'offer_conditions_'~ key}}" value="{{ offer.conditions }}" placeholder="Condition(s)...">
    </div>
    <div class="flex justify-between items-center">
        <p class="underline underline-offset-2">Composition :</p>
        <button type="button" class="text-secondary bg-primary/50 px-4 py-1" onclick="addComposition(event)">Ajouter</button>
    </div>
    <ol class="compositions flex flex-col gap-2"
    >
    {% for key, composition in offer.description %}
        {{ _self.compositions_prototype(key, composition, key_menu) }}
    {% endfor %}
    </ol>
    <div class="my-2 relative after:conten-[''] before:absolute before:w-[100px] before:h-px before:bg-secondary before:opacity-50 before:-top-2">
        <label for="{{ 'price_'~ key }}" hidden>Prix :</label>
        <div class="flex items-center input_profil w-[120px]">
            <i class="fa-solid fa-euro-sign form_icon bg-primary/20"></i>
            <input required type="number" class="w-full pr-2 bg-primary/20 input_whitePlaceholder input_withoutIcon" id="{{ 'price_'~ key}}" name="{{ 'price_'~ key}}" value="{{ offer.price }}" >
        </div>
    </div>
</li>
{% endmacro %}
{% macro compositions_prototype(key, composition, key_menu) %}
    <li class="name flex gap-2">
        <div class="flex-1">
            <label hidden for="{{'offer_'~ key_menu ~'_composition_title_'~ key }}">Composer de...</label>
            <input required minLength="2" maxLength="200"  type="text" class="pr-2 bg-primary/20 input_whitePlaceholder input_withoutIcon" id="{{'offer_'~ key_menu ~'_composition_title_'~ key }}" name="{{'offer_'~ key_menu ~'_composition_title_'~ key }}" value="{{ composition }}" placeholder="Plat...">
        </div>
        {% if key >= 1 %}
        <button>
            <i class="fa-solid fa-trash button-full bg-primary/50 button_profil" onclick="deleteComposition(event)"></i>
        </button>
        {% endif %}
    </li>
{% endmacro %}